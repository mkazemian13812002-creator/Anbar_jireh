<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ù„Ø¬Ø³ØªÛŒÚ© Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @font-face { font-family: 'B Nazanin'; src: local('B Nazanin'); }
        :root { --main: #1b5e20; --gold: #c5a059; --danger: #e11d48; --bg: #f8fafc; }
        
        body { font-family: 'B Nazanin', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 0; font-size: 18px; color: #1e293b; }

        /* Ù„ÙˆØ¯ÛŒÙ†Ú¯ */
        #splash { position: fixed; inset: 0; background: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 3000; transition: 0.5s; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ ØµÙØ­Ø§Øª */
        .page { display: none; padding: 20px; animation: fadeIn 0.4s; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ù…Ø¯Ø±Ù† */
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 30px; }
        .menu-item { background: white; padding: 25px; border-radius: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; cursor: pointer; transition: 0.3s; }
        .menu-item:active { transform: scale(0.95); background: var(--main); color: white; }

        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ùˆ ÙØ±Ù…â€ŒÙ‡Ø§ */
        .card { background: white; padding: 20px; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 1px solid white; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: 1px solid #cbd5e1; font-family: 'B Nazanin'; font-size: 17px; box-sizing: border-box; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù‡ÙØªÙ‡ */
        .weekday-picker { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
        .day-btn { padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; cursor: pointer; background: #f1f5f9; }
        .day-btn.selected { background: var(--main); color: white; border-color: var(--main); }

        .btn-main { background: var(--main); color: white; border: none; width: 100%; padding: 15px; border-radius: 14px; font-weight: bold; font-size: 19px; font-family: 'B Nazanin'; margin-top: 15px; cursor: pointer; box-shadow: 0 5px 15px rgba(27, 94, 32, 0.3); }
        
        /* Ù„ÛŒØ³Øª Ø§Ù‚Ù„Ø§Ù… */
        .item-card { background: white; padding: 15px; border-radius: 18px; margin-bottom: 12px; border-right: 6px solid var(--gold); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
        .badge { font-size: 12px; padding: 3px 8px; border-radius: 6px; font-weight: bold; }
        .expired { background: #fee2e2; color: #dc2626; }
    </style>
</head>
<body>

<div id="splash">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e0/Police_of_Iran_Emblem.svg/1200px-Police_of_Iran_Emblem.svg.png" width="120" alt="Ù†Ø§Ø¬Ø§">
    <h2 style="color: var(--main); margin-top: 15px;">Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¬ÛŒØ±Ù‡</h2>
    <div style="width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top-color: var(--main); border-radius: 50%; animation: spin 1s linear infinite;"></div>
</div>

<div id="menu-page" class="page active">
    <div style="text-align: center; margin-bottom: 20px;">
        <h2 style="color: var(--main); margin-bottom: 5px;">Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ù†Ø¨Ø§Ø±</h2>
        <p style="font-size: 14px; color: #64748b;">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ù‚ÛŒÙ‚ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ</p>
    </div>
    <div class="menu-grid">
        <div class="menu-item" onclick="navigate('edit-page')">ğŸ“ <b>Ø«Ø¨Øª Ùˆ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¬ÛŒØ±Ù‡</b></div>
        <div class="menu-item" onclick="navigate('view-page')">ğŸ“‹ <b>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡</b></div>
    </div>
</div>

<div id="edit-page" class="page">
    <button onclick="navigate('menu-page')" style="background:none; border:none; color:var(--main); font-weight:bold; cursor:pointer;">â¬… Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†Ùˆ</button>
    <div class="card" style="margin-top:15px;">
        <h3 id="form-title">Ø«Ø¨Øª Ù…Ø­ØµÙˆÙ„ Ùˆ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…ØµØ±Ù</h3>
        <input type="hidden" id="edit-idx">
        <input type="text" id="name" placeholder="Ù†Ø§Ù… Ú©Ø§Ù„Ø§ (Ù…Ø«Ù„Ø§Ù‹: Ú¯ÙˆØ´Øª Ù…Ù†Ø¬Ù…Ø¯)">
        <input type="text" id="entry-date" placeholder="ØªØ§Ø±ÛŒØ® ÙˆØ±ÙˆØ¯ (Û±Û´Û°Û´/Û±Û°/Û°Û·)">
        <input type="text" id="exp-date" placeholder="ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§ (Û±Û´Û°Ûµ/Û°Û±/Û°Û±)">
        <input type="number" id="total-qty" placeholder="Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ (Ú©ÛŒÙ„Ùˆ/Ø¹Ø¯Ø¯)">
        <input type="number" id="daily-usage" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ù…ØµØ±Ù Ø¯Ø± Ù‡Ø± ÙˆØ¹Ø¯Ù‡">
        
        <label style="font-size: 14px; color: #64748b;">Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…ØµØ±Ù Ø¯Ø± Ù‡ÙØªÙ‡:</label>
        <div class="weekday-picker" id="days-picker">
            <div class="day-btn" onclick="toggleDay(this, 0)">Ø´Ù†Ø¨Ù‡</div>
            <div class="day-btn" onclick="toggleDay(this, 1)">Û±Ø´Ù†Ø¨Ù‡</div>
            <div class="day-btn" onclick="toggleDay(this, 2)">Û²Ø´Ù†Ø¨Ù‡</div>
            <div class="day-btn" onclick="toggleDay(this, 3)">Û³Ø´Ù†Ø¨Ù‡</div>
            <div class="day-btn" onclick="toggleDay(this, 4)">Û´Ø´Ù†Ø¨Ù‡</div>
            <div class="day-btn" onclick="toggleDay(this, 5)">ÛµØ´Ù†Ø¨Ù‡</div>
            <div class="day-btn" onclick="toggleDay(this, 6)">Ø¬Ù…Ø¹Ù‡</div>
        </div>

        <button class="btn-main" id="save-btn" onclick="saveItem()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø³Ø§Ù…Ø§Ù†Ù‡</button>
    </div>
</div>

<div id="view-page" class="page">
    <button onclick="navigate('menu-page')" style="background:none; border:none; color:var(--main); font-weight:bold; cursor:pointer;">â¬… Ø¨Ø§Ø²Ú¯Ø´Øª</button>
    <div class="card" style="margin-top:15px;">
        <input type="text" id="search" placeholder="ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ù„Ø§..." onkeyup="renderItems()">
        <div id="list-container"></div>
        <button class="btn-main" style="background:#16a34a" onclick="exportExcel()">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„</button>
    </div>
</div>

<script>
    let inventory = JSON.parse(localStorage.getItem('smart_police_db')) || [];
    let selectedDays = [];

    // Ù„ÙˆØ¯ÛŒÙ†Ú¯
    window.onload = () => { setTimeout(() => { document.getElementById('splash').style.display='none'; }, 3000); };

    function navigate(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'view-page') renderItems();
        if(id === 'edit-page') resetForm();
    }

    function toggleDay(btn, dayIdx) {
        btn.classList.toggle('selected');
        if(selectedDays.includes(dayIdx)) {
            selectedDays = selectedDays.filter(d => d !== dayIdx);
        } else {
            selectedDays.push(dayIdx);
        }
    }

    function saveItem() {
        const name = document.getElementById('name').value;
        const total = parseFloat(document.getElementById('total-qty').value);
        const usage = parseFloat(document.getElementById('daily-usage').value);
        const entry = document.getElementById('entry-date').value;
        const exp = document.getElementById('exp-date').value;

        if(!name || isNaN(total) || selectedDays.length === 0) {
            alert("Ù†Ø§Ù…ØŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ùˆ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø±ÙˆØ² Ù…ØµØ±Ù Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯");
            return;
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ØµØ±Ù Ù…Ø§Ù‡Ø§Ù†Ù‡: (ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø¯Ø± Ù‡ÙØªÙ‡ * Ù…ØµØ±Ù Ù‡Ø± ÙˆØ¹Ø¯Ù‡ * Û´ Ù‡ÙØªÙ‡)
        const monthlyUsage = selectedDays.length * usage * 4;
        const item = { 
            name, total, usage, entry, exp, 
            days: [...selectedDays], 
            rem: total - monthlyUsage 
        };

        const editIdx = document.getElementById('edit-idx').value;
        if(editIdx !== "") inventory[editIdx] = item;
        else inventory.unshift(item);

        localStorage.setItem('smart_police_db', JSON.stringify(inventory));
        alert("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯");
        navigate('menu-page');
    }

    function renderItems() {
        const container = document.getElementById('list-container');
        container.innerHTML = '';
        inventory.forEach((item, i) => {
            const isLow = item.rem < 0;
            const daysNames = ["Ø´", "Û±Ø´", "Û²Ø´", "Û³Ø´", "Û´Ø´", "ÛµØ´", "Ø¬"];
            const myDays = item.days.map(d => daysNames[d]).join("ØŒ ");

            container.innerHTML += `
                <div class="item-card">
                    <div style="flex:1">
                        <div style="font-weight:bold; font-size:19px">${item.name}</div>
                        <div style="font-size:13px; color:#64748b">Ø¨Ø±Ù†Ø§Ù…Ù‡: ${myDays} | Ø§Ù†Ù‚Ø¶Ø§: ${item.exp || '---'}</div>
                        <div style="font-size:14px; margin-top:5px">Ù…Ø§Ù†Ø¯Ù‡ Ù†Ù‡Ø§ÛŒÛŒ: <b style="color:${isLow?'red':'green'}">${item.rem}</b></div>
                    </div>
                    <div style="text-align:left">
                        <button onclick="editItem(${i})" style="border:none; background:#f1f5f9; padding:5px 10px; border-radius:5px; font-family:'B Nazanin'">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                        <button onclick="deleteItem(${i})" style="border:none; background:#fee2e2; color:red; padding:5px 10px; border-radius:5px; margin-top:5px">Ø­Ø°Ù</button>
                    </div>
                </div>`;
        });
    }

    function editItem(i) {
        const item = inventory[i];
        navigate('edit-page');
        document.getElementById('name').value = item.name;
        document.getElementById('entry-date').value = item.entry;
        document.getElementById('exp-date').value = item.exp;
        document.getElementById('total-qty').value = item.total;
        document.getElementById('daily-usage').value = item.usage;
        document.getElementById('edit-idx').value = i;
        document.getElementById('form-title').innerText = "ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„";
        
        // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø±ÙˆØ²Ù‡Ø§
        selectedDays = [...item.days];
        const buttons = document.querySelectorAll('.day-btn');
        buttons.forEach((btn, idx) => {
            if(selectedDays.includes(idx)) btn.classList.add('selected');
            else btn.classList.remove('selected');
        });
    }

    function deleteItem(i) { if(confirm("Ø­Ø°Ù Ø´ÙˆØ¯ØŸ")) { inventory.splice(i,1); localStorage.setItem('smart_police_db', JSON.stringify(inventory)); renderItems(); } }

    function resetForm() {
        document.querySelectorAll('input').forEach(inp => inp.value='');
        document.getElementById('edit-idx').value = "";
        document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('selected'));
        selectedDays = [];
    }

    function exportExcel() {
        const ws = XLSX.utils.json_to_sheet(inventory);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Inventory");
        XLSX.writeFile(wb, "Gozaresh_Naja.xlsx");
    }
</script>

<style> @keyframes spin { 100% { transform: rotate(360deg); } } </style>
</body>
</html>
